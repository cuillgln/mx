(function() {
	var StaffPositionHistory = mxLib.StaffPositionHistory = function() {
		this.polyline = null;
		this.animateId = null;
	}
	
	StaffPositionHistory.prototype.getPathData = function(rfId, begin, end) {
		if (this.polyline) {
			map.removeOverlay(this.polyline);
			this.polyline = null;
		}
		if (this.animateId) {
			canvasLayer.deletePathAnimate(this.animateId);
			this.animateId = null;
			canvasLayer.update();
		}
		var self = this;
		$.ajax({
			url : contextPath + "/staff/history?rfId=" + rfId + "&begin=" + begin + "&end=" + end,
			type : "GET",
			async : false,
			dataType : "json",
			success : function(data) {
				var points = [];
				for (var i = 0; i < data.length; i++) {
					var point = data[i].point;
					points.push(new mxLib.Point(data[i].x, data[i].y));
				}
				if (points.length > 1) {
					self.polyline = new mxLib.Polyline(points, {strokeColor:"blue", strokeWeight:2, strokeOpacity:0.5});
					map.addOverlay(self.polyline);
					var shapePath = "M20.247267141666654,-60.126870000000004C20.247267141666654,-60.126870000000004,-18.579387621666662,-60.126870000000004,-18.579387621666662,-60.126870000000004C-21.630053328,-60.126870000000004,-24.126052559999998,-57.63087000000001,-24.126052559999998,-54.580203355C-24.126052559999998,-54.580203355,-24.126052559999998,-15.753536709999999,-24.126052559999998,-15.753536709999999C-24.126052559999998,-12.702870064999999,-21.630053328,-10.206870064999999,-18.579387621666662,-10.206870064999999C-18.579387621666662,-10.206870064999999,-7.486057680000002,-10.206870064999999,-7.486057680000002,-10.206870064999999C-7.486057680000002,-10.206870064999999,0.8339397599999998,-1.886870065,0.8339397599999998,-1.886870065C0.8339397599999998,-1.886870065,9.153937200000001,-10.206870065,9.153937200000001,-10.206870065C9.153937200000001,-10.206870065,20.247267141666654,-10.206870065,20.247267141666654,-10.206870065C23.297932847999995,-10.206870065,25.793932079999998,-12.702870064999999,25.793932079999998,-15.753536709999999C25.793932079999998,-15.753536709999999,25.793932079999998,-54.580203355,25.793932079999998,-54.580203355C25.793932079999998,-57.63087,23.297932848000002,-60.126870000000004,20.247267141666654,-60.126870000000004C20.247267141666654,-60.126870000000004,20.247267141666654,-60.126870000000004,20.247267141666654,-60.126870000000004M0.8339397599999998,-50.97487C4.993938479999997,-50.97487,8.321937456,-47.64687,8.321937456,-43.48687C8.321937456,-39.32687000000001,4.993938479999997,-35.998870000000004,0.8339397599999998,-35.998870000000004C-3.326058960000001,-35.998870000000004,-6.654057936000001,-39.32687,-6.654057936000001,-43.48687C-6.654057936000001,-47.64687,-3.326058960000001,-50.97487,0.8339397599999998,-50.97487C0.8339397599999998,-50.97487,0.8339397599999998,-50.97487,0.8339397599999998,-50.97487M17.473934639999996,-21.300203355C17.473934639999996,-21.300203355,-15.80605512,-21.300203355,-15.80605512,-21.300203355C-15.80605512,-21.300203355,-15.80605512,-23.796203355000003,-15.80605512,-23.796203355000003C-15.80605512,-29.342870000000005,-4.7127251783333435,-32.39353671000001,0.8339397599999998,-32.39353671000001C6.380604698333343,-32.39353671000001,17.473934639999996,-29.342870065,17.473934639999996,-23.796203355000003C17.473934639999996,-23.796203355000003,17.473934639999996,-21.300199,17.473934639999996,-21.300199";
					// shapePath = "M0 238l0 275q0 71 47 96 17 8 41 8l207 0q23 0 43-8 59-29 59-96l0-275q-4-31-31-28t-28 28l0 262q-2 9-18 8t-15-8l0-600q-4-27-26-36t-42 4-20 34l0 365q-4 18-22 15t-17-15l0-365q-2-29-25-38t-42 3-21 33l0 600q-4 9-18 8t-15-8l0-262q-4-31-31-28t-26 28z m102 505q0 40 28 68t68 29 69-29 28-68-28-68-69-29-68 29-28 68z";
					self.animateId = canvasLayer.addPathAnimate(points, { pathData: shapePath, fillColor: "#dd11dd", time: 100, arrowScale: 10000, noScaleZoom: 6,
						zoomNoScale:false, cb: function(pos) {
								if (pos == 100) {
									canvasLayer.deletePathAnimate(self.animateId);
									self.animateId = null;
									canvasLayer.update();
								}
							}
					});
					canvasLayer.update();
				}
			}
		});
	}
})();